{% extends 'base.html.twig' %}

{% block stylesheets_implemeting_plugins %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/admin/sb-admin-2.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/admin/breadcrumb.css') }}" />
    <link rel="stylesheet" href="{{ asset('vendor/metisMenu/dist/metisMenu.min.css') }}">
    <link rel="stylesheet" href="{{ asset('vendor/blueimp-file-upload/css/jquery.fileupload.css') }}">
    <link rel="stylesheet" href="{{ asset('vendor/PACE/themes/blue/pace-theme-minimal.css') }}">
{% endblock %}

{% block javascripts_implementing_plugins %}
    {{ parent() }}
    <script type="text/javascript" src="{{ asset('assets/js/admin/sb-admin-2.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/metisMenu/dist/metisMenu.min.js') }}"></script>
    <!-- The jQuery UI widget factory, can be omitted if jQuery UI is already included -->
    <script type="text/javascript" src="{{ asset('vendor/blueimp-file-upload/js/vendor/jquery.ui.widget.js') }}"></script>
    <!-- The Load Image plugin is included for the preview images and image resizing functionality -->
    <script type="text/javascript"  src="https://blueimp.github.io/JavaScript-Load-Image/js/load-image.all.min.js"></script>
    <!-- The Canvas to Blob plugin is included for image resizing functionality -->
    <script type="text/javascript"  src="https://blueimp.github.io/JavaScript-Canvas-to-Blob/js/canvas-to-blob.min.js"></script>
    <!-- The Iframe Transport is required for browsers without support for XHR file uploads -->
    <script type="text/javascript" src="{{ asset('vendor/blueimp-file-upload/js/jquery.iframe-transport.js') }}"></script>
    <!-- The basic File Upload plugin -->
    <script type="text/javascript" src="{{ asset('vendor/blueimp-file-upload/js/jquery.fileupload.js') }}"></script>
    <!-- The File Upload processing plugin -->
    <script type="text/javascript"  src="{{ asset('vendor/blueimp-file-upload/js/jquery.fileupload-process.js') }}"></script>
    <!-- The File Upload image preview & resize plugin -->
    <script type="text/javascript"  src="{{ asset('vendor/blueimp-file-upload/js/jquery.fileupload-image.js') }}"></script>
    <script type="text/javascript" src="{{ asset('vendor/PACE/pace.min.js') }}"></script>
{% endblock %}

{% block stylesheets_code %}
    <style type="text/css">body{padding-top:0}</style>
{% endblock %}

{#{% block javascript %}
    <script type="text/javascript">
        // TODO: Add posibility to change page faster with javascript

        // When using Hash to update website
        $(document).ready(function() {
            $("#screen-loading").hide();
            if("onhashchange" in window) {
                $("#screen-loading").show();
                var href = location.hash;
                href = href.substr(2);
                setTimeout(function () {
                    $.ajax({
                        url		: "/account/do.php",
                        data	: {
                            a : "getTemplate",
                            tpl : "account/page-" + href
                        },
                        complete: function() {
                            $("#screen-loading").hide();
                        },
                        success	: function(data) {
                            $("#screen-content").empty().append($(data));
                        },
                        error	: function() {
                            var n = noty({
                                text		: "Error while loading page",
                                type		: "error",
                                layout		: "bottomRight",
                                timeout		: 3000,
                                maxVisible  : 3
                            });
                        }
                    });
                }, 1000);
            }
            function onHashChanged() {
                $("#screen-loading").show();
                var href = location.hash;
                href = href.substr(2);
                setTimeout(function () {
                    $.ajax({
                        url		: "/account/do.php",
                        data	: {
                            a : "getTemplate",
                            tpl : "account/page-" + href
                        },
                        complete: function() {
                            $("#screen-loading").hide();
                        },
                        success	: function(data) {
                            $("#screen-content").empty().append($(data));
                        },
                        error	: function() {
                            var n = noty({
                                text		: 'Error while loading page',
                                type		: 'error',
                                layout		: 'bottomRight',
                                timeout		: 3000,
                                maxVisible  : 3
                            });
                        }
                    });
                }, 1000);
            }
            window.onhashchange = onHashChanged;
        });
        $(function(){
            $(document).on("click", "li.active > a", function(){
                var $parent = $(this).parent();

                // Ensure link isn't just a dropdown menu link
                if (!$parent.hasClass("dropdown")){
                    // Deactivate tab buttons
                    $("#testtab li").removeClass("active");

                    // Hides tab contents
                    tabName = $(this).attr("href");
                    $(tabName).removeClass("active").addClass("fade");
                }
            });
        });
    </script>

    <script src="{{ asset('assets/js/admin/ControlPanel.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        // VERSION 2 of JAVASCRIPT Panel

        $(document).ready(function() {
            ControlPanelSettings.ajaxPageTarget = '<?php echo \Core\Server::URL('www', 'do.php'); ?>';
            ControlPanelSettings.debug = true;
            ControlPanelSettings.controlPanelPageSystem = '<?php echo $aAccountConfig['controlPanelPageSystem']; ?>';

            if(ControlPanelSettings.controlPanelPageSystem === 'href' || ControlPanelSettings.controlPanelPageSystem === 'hash')
            {
                ControlPanel.init('#screen-content', '#screen-loading');
                ControlPanel.startLoading();

                if(location.hash.length == 0)
                    location.replace('#/home')

                var sPage = location.hash;
                sPage = sPage.substr(2);
                ControlPanel.changePage(sPage);

                if(ControlPanelSettings.controlPanelPageSystem === 'href')
                {
                    $('*[data-toggle="page"]').click(function() {
                        ControlPanel.startLoading();

                        sPage = $(this).attr('href');
                        sPage = sPage.substr(2);
                        ControlPanel.changePage(sPage);
                    });
                }
                else if(ControlPanelSettings.controlPanelPageSystem === 'hash')
                {
                    if("onhashchange" in window) {
                        ControlPanel.startLoading();

                        sPage = location.hash;
                        sPage = sPage.substr(2);

                        ControlPanel.changePage(sPage);
                    }

                    function onHashChanged() {
                        ControlPanel.startLoading();

                        sPage = location.hash;
                        sPage = sPage.substr(2);

                        ControlPanel.changePage(sPage);
                    }

                    window.onhashchange = onHashChanged;
                }
                else if(ControlPanelSettings.controlPanelPageSystem === 'url')
                {
                    // the browser will change the page itself
                }
            }
        });
    </script>

    <script type="text/javascript">
        // TODO: Better functionality in javascript page changer

        function changePage(urlPath) {
            var ajax = new XMLHttpRequest();
            ajax.onreadystatechange = function () {
                if (ajax.readyState == 4 && ajax.status == 200) {
                    console.log("[Ajax] Page loaded");
                    processAjaxData(ajax, urlPath);
                }
            };
            page = "https://account.orbitrondev.org/api/panel_pages?p=" + encodeURI(urlPath);
            console.log("[Ajax] Loading \"" + urlPath + "\" (from: " + page + ")");
            ajax.open("GET", page, true);
            ajax.send();
        }

        function processAjaxData(response, urlPath) {
            document.getElementById("content").innerHTML = response.responseText;
            document.title = response.pageTitle;
            window.history.pushState({
                "html": document.body.innerHTML,
                "pageTitle": document.getElementsByTagName("title")[0].innerHTML
            }, "", urlPath);
        }

        $(document).ready(function () {
            history.pushState({
                "html": document.body.innerHTML,
                "pageTitle": document.getElementsByTagName("title")[0].innerHTML
            }, "", window.location.href);

            window.onpopstate = function (e) {
                console.info("Returned a page");
                //console.log(e.state.html);
                if (typeof e.state !== undefined) {
                    //alert(e.state.html)
                    document.getElementsByTagName("body")[0].innerHTML = e.state.html;
                    document.title = e.state.pageTitle;
                }
            };
        });
    </script>
{% endblock %}#}

{% block content %}
    <div id="wrapper">
        <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">{{ 'Toggle navigation'|trans }}</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                {% block brand %}<a class="navbar-brand" href="#">Panel</a>{% endblock %}
            </div>
            <!-- /.navbar-header -->
            <ul class="nav navbar-top-links navbar-right">
                {% block navigation_top %}{% endblock %}
            </ul>
            <!-- /.navbar-top-links -->
            <div class="navbar-default sidebar" role="navigation">
                <div class="sidebar-nav navbar-collapse">
                    <ul class="nav" id="side-menu">
                        {% block navigation %}{% endblock %}
                    </ul>
                    <!-- /.nav -->
                </div>
                <!-- /.sidebar-collapse -->
            </div>
            <!-- /.navbar-static-side -->
        </nav>
        <div id="page-wrapper">
            <div id="content" class="row">
                {% block body %}{% endblock %}
            </div><!-- /.screen-content -->
            <br />
        </div><!-- /#page-wrapper -->
    </div>
    <!-- /#wrapper -->
{% endblock %}